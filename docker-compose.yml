# ============================================
# LifeCycle Docker Compose
# ============================================
# 使用方式:
#   1. 复制 .env.example 为 .env.production
#   2. 修改 BETTER_AUTH_SECRET（必须）
#   3. docker compose --env-file .env.production up -d
#
# 域名/地址无需配置，应用从请求自动检测
# ============================================

services:
  app:
    # ---- 二选一：预构建镜像 或 本地构建 ----
    # 方式 1: 拉取预构建镜像（推荐）
    # image: ghcr.io/YOUR_OWNER/lifecycle:latest
    # 方式 2: 本地源码构建（取消注释下方，注释上方 image 行）
    build:
      context: .
      dockerfile: Dockerfile
    container_name: lifecycle
    restart: unless-stopped
    ports:
      - "${APP_PORT:-3000}:3000"
    environment:
      # ---- 数据库 ----
      - DATABASE_PROVIDER=${DATABASE_PROVIDER:-sqlite}
      - DATABASE_URL=file:/app/data/lifecycle.db
      # Turso 远程数据库（仅 DATABASE_PROVIDER=turso 时需要）
      - TURSO_DATABASE_URL=${TURSO_DATABASE_URL:-}
      - TURSO_AUTH_TOKEN=${TURSO_AUTH_TOKEN:-}
      # ---- 认证 ----
      - BETTER_AUTH_SECRET=${BETTER_AUTH_SECRET}
      # ---- 定时任务 ----
      - CRON_SECRET=${CRON_SECRET:-}
      - CRON_ENABLED=${CRON_ENABLED:-true}
      - CRON_SCHEDULE=${CRON_SCHEDULE:-0 9 * * *}
      - CRON_TIMEZONE=${CRON_TIMEZONE:-Asia/Shanghai}
    volumes:
      - lifecycle-data:/app/data
    logging:
      driver: json-file
      options:
        max-size: "10m"
        max-file: "3"

volumes:
  lifecycle-data:
    name: lifecycle-data
