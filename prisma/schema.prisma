// 1. æ•°æ®æºé…ç½®
datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

// ==========================================
// ğŸ” è®¤è¯æ¨¡å— (Auth / User System)
// éµå¾ª NextAuth.js (Auth.js) é€‚é…å™¨æ ‡å‡†
// ==========================================

model User {
  id            String    @id @default(cuid())
  name          String?
  email         String?   @unique
  emailVerified DateTime?
  image         String?   // ç”¨æˆ·å¤´åƒ
  password      String?   // å‡­è¯ç™»å½•ä½¿ç”¨çš„å“ˆå¸Œå¯†ç 
  
  accounts      Account[]
  sessions      Session[]
  
  // ä¸šåŠ¡å…³è”
  items         Item[]
  categories    Category[]
  tags          Tag[]
  usageLogs     UsageLog[]

  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
}

// ä»…å½“ä½¿ç”¨ç¬¬ä¸‰æ–¹ç™»å½•(Google/GitHub)æ—¶éœ€è¦æ­¤è¡¨ï¼Œå»ºè®®ä¿ç•™
model Account {
  id                 String  @id @default(cuid())
  userId             String
  type               String
  provider           String
  providerAccountId  String
  refresh_token      String? 
  access_token       String? 
  expires_at         Int?
  token_type         String?
  scope              String?
  id_token           String?
  session_state      String?

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([provider, providerAccountId])
}

model Session {
  id           String   @id @default(cuid())
  sessionToken String   @unique
  userId       String
  expires      DateTime
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

// ==========================================
// ğŸ“¦ æ ¸å¿ƒä¸šåŠ¡æ¨¡å— (Inventory System)
// ==========================================

model Category {
  id        String   @id @default(cuid())
  name      String
  icon      String?  // å­˜å‚¨ Lucide å›¾æ ‡åç§°ï¼Œå¦‚ "toothbrush"
  color     String?  // å­˜å‚¨é¢œè‰²ä»£ç ï¼Œå¦‚ "#FF0000"
  
  userId    String
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  items     Item[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([userId, name]) // åŒä¸€ä¸ªç”¨æˆ·ä¸‹åˆ†ç±»åä¸é‡å¤
}

model Tag {
  id        String   @id @default(cuid())
  name      String
  
  userId    String
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  items     Item[]   // éšå¼å¤šå¯¹å¤šå…³ç³»

  createdAt DateTime @default(now())

  @@unique([userId, name]) // åŒä¸€ä¸ªç”¨æˆ·ä¸‹æ ‡ç­¾åä¸é‡å¤
}

model Item {
  id               String   @id @default(cuid())
  
  // 1. åŸºç¡€ä¿¡æ¯
  name             String
  image            String?  // ç‰©å“ Logo/ç…§ç‰‡ URL
  brand            String?  // å“ç‰Œ
  price            Decimal? // ä»·æ ¼ (Prisma ä¼šå¤„ç† SQLite çš„ç²¾åº¦é—®é¢˜)
  note             String?  // å¤‡æ³¨
  
  // 2. çŠ¶æ€ä¸åº“å­˜
  stock            Int      @default(1) // å½“å‰åº“å­˜æ•°é‡
  isArchived       Boolean  @default(false) // å½’æ¡£ï¼ˆé€»è¾‘åˆ é™¤ï¼‰
  
  // 3. ç”Ÿå‘½å‘¨æœŸå…³é”®æŒ‡æ ‡
  // ä¸Šæ¬¡æ›´æ¢/å¼€å§‹ä½¿ç”¨æ—¶é—´ (ç”¨äºè®¡ç®—è¿›åº¦)
  lastOpenedAt     DateTime? 
  
  // ç”Ÿå‘½å‘¨æœŸ (å¤©æ•°) - è½¯æ€§å‘¨æœŸï¼Œå¦‚â€œç‰™åˆ·å»ºè®®90å¤©æ›´æ¢â€
  lifespanDays     Int?     
  
  // ç¡¬æ€§è¿‡æœŸæ—¶é—´ - ç»å¯¹æ—¥æœŸï¼Œå¦‚â€œç‰›å¥¶ 2025-10-01 è¿‡æœŸâ€
  expirationDate   DateTime? 
  
  // æå‰é€šçŸ¥å¤©æ•° (é»˜è®¤ 3 å¤©)
  notifyAdvanceDays Int     @default(3)
  
  // 4. å…³è”å…³ç³»
  categoryId       String
  category         Category @relation(fields: [categoryId], references: [id])
  
  userId           String
  user             User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  tags             Tag[]    // å…³è”æ ‡ç­¾è¡¨
  logs             UsageLog[]

  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt

  @@index([userId])
  @@index([categoryId])
}

// ==========================================
// ğŸ“Š è¿½è¸ªæ¨¡å— (Tracking)
// ==========================================

model UsageLog {
  id             String      @id @default(cuid())
  
  action         String      // å»ºè®®ä½¿ç”¨æšä¸¾é€»è¾‘ï¼Œä½† SQLite å»ºè®®å­˜ String: "OPEN", "RESTOCK", "FINISH", "EDIT"
  changeQuantity Int         // åº“å­˜å˜åŒ–é‡ï¼Œä¾‹å¦‚ +5 æˆ– -1
  note           String?     // æ“ä½œå¤‡æ³¨ï¼Œå¦‚â€œåŒåä¸€å›¤è´§â€
  
  itemId         String
  item           Item        @relation(fields: [itemId], references: [id], onDelete: Cascade)
  
  userId         String
  user           User        @relation(fields: [userId], references: [id], onDelete: Cascade)

  createdAt      DateTime    @default(now()) // æ“ä½œå‘ç”Ÿæ—¶é—´
  
  @@index([itemId])
  @@index([createdAt])
}
